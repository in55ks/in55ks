<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Clicks and Extract Click ID</title>
</head>
<body>

    <div id="object_container" style="width:100%;height:100%; position: relative;">
        <!-- Вставка iframe -->
        <iframe id="myFrame" src="https://edwmpt.com/embed/lf?c=object_container&site=jasmin&cobrandId=&psid=inskkkk&pstool=202_1&psprogram=pps&campaign_id=&category=girl&forcedPerformers[]=AliceGoldie&vp[showChat]=true&vp[chatAutoHide]=true&vp[showCallToAction]=&vp[showPerformerName]=&vp[showPerformerStatus]=&ms_notrack=1&subAffId={SUBAFFID}" style="width:100%; height:100%; border:none;"></iframe>
    </div>

    <script>
        // Функция для получения параметра из URL
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                  results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Извлекаем bemobdata из URL
        const bemobData = getParameterByName('bemobdata');

        let clickId = null;
        if (bemobData) {
            // Декодируем bemobdata
            const decodedData = decodeURIComponent(bemobData);

            // Ищем значение click_id после 'e='
            const clickIdMatch = decodedData.match(/e=([^..]+)/);
            if (clickIdMatch && clickIdMatch[1]) {
                clickId = clickIdMatch[1];
                console.log('Click ID извлечен:', clickId);
            } else {
                console.error('Click ID не найден в bemobdata.');
            }
        } else {
            console.error('Параметр bemobdata не найден.');
        }

        // Отслеживание кликов на контейнере
        document.getElementById('object_container').addEventListener('click', function(event) {
            console.log('Container clicked');

            // Проверка наличия clickId
            if (!clickId) {
                console.error('Click ID не был извлечен. Пожалуйста, попробуйте позже.');
                return;
            }

            // Формируем данные для POST-запроса
            const payout = '50';  // Замените на нужное значение
            const txid = '78910'; // Замените на нужное значение
            const status = 'confirmed'; // Замените на нужное значение

            // Формируем URL для POST-запроса
            const postData = `cid=${clickId}&payout=${payout}&txid=${txid}&status=${status}`;
            const url = 'https://zebix.bemobtrk.com/conversion.txt';

            // Отправляем POST-запрос
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: postData
            })
            .then(response => response.text())
            .then(data => console.log('Конверсия отправлена:', data))
            .catch(error => console.error('Ошибка:', error));
        });
    </script>

</body>
</html>
