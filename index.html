<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversion Tracking</title>
</head>
<body>

    <!-- Встраивание пикселя трекинга -->
    <script type="text/javascript">
        // Сохраняем значения параметров в глобальные переменные
        let clickId = null;
        let price = null;

        // Функция для получения параметра из URL
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                  results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Извлекаем click_id и другие параметры из URL
        clickId = getParameterByName('click_id');
        price = getParameterByName('price');

        // Встраиваем скрипт пикселя трекера
        !function(){
            var a=document.createElement("script");
            a.type="text/javascript";
            a.async=!0;
            a.src="https://zebix.bemobtrk.com/landing/0c73f30b-8752-4483-8361-1992ad4215d4?callback=REPLACE&rule=REPLACE&path=REPLACE&landing=REPLACE&"+window.location.search.substring(1);
            var b=document.getElementsByTagName("script")[0];
            b.parentNode.insertBefore(a,b);
        }();
    </script>

    <!-- Кнопка для отправки постбека -->
    <button id="conversionButton">Отправить конверсию</button>

    <script>
        // Обработчик клика на кнопке
        document.getElementById('conversionButton').addEventListener('click', () => {
            if (!clickId) {
                console.error('Click ID не был извлечен. Пожалуйста, попробуйте позже.');
                return;
            }

            // Формируем URL постбека
            const url = `https://zebix.bemobtrk.com/conversion.txt?cid=${clickId}&payout=${price}&txid=12345&status=confirmed`;

            // Отправляем POST запрос
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
            })
            .then(response => response.text())
            .then(data => {
                console.log('Конверсия отправлена:', data);
            })
            .catch(error => {
                console.error('Ошибка:', error);
            });
        });
    </script>

</body>
</html>
