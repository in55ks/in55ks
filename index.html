<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversion Tracking</title>
</head>
<body>

    <!-- Встраивание пикселя трекинга -->
    <script type="text/javascript">
        let clickId = null;

        // Функция для получения параметра из URL
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                  results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Извлекаем bemobdata из URL
        const bemobData = getParameterByName('bemobdata');

        if (bemobData) {
            // Декодируем bemobdata
            const decodedData = decodeURIComponent(bemobData);

            // Ищем значение click_id, закодированное как e%3D в bemobdata
            const clickIdMatch = decodedData.match(/\.e%3D([^\.]+)/);
            if (clickIdMatch && clickIdMatch[1]) {
                clickId = clickIdMatch[1];
                console.log('Click ID извлечен:', clickId);
            } else {
                console.error('Click ID не найден в bemobdata.');
            }
        } else {
            console.error('Параметр bemobdata не найден.');
        }
    </script>

    <!-- Кнопка для отправки постбека -->
    <button id="conversionButton">Отправить конверсию</button>

    <script>
        // Обработчик клика на кнопке
        document.getElementById('conversionButton').addEventListener('click', () => {
            if (!clickId) {
                console.error('Click ID не был извлечен. Пожалуйста, попробуйте позже.');
                return;
            }

            // Задаем значения для остальных параметров запроса
            const payout = '50';  // Замените на нужное значение, если нужно
            const txid = '78910'; // Замените на нужное значение, если нужно
            const status = 'confirmed'; // Замените на нужное значение, если нужно

            // Формируем URL с параметрами, включая Click ID
            const url = `https://zebix.bemobtrk.com/conversion.txt?cid=${clickId}&payout=${payout}&txid=${txid}&status=${status}`;

            // Отправляем POST запрос
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
            })
            .then(response => response.text())
            .then(data => {
                console.log('Конверсия отправлена:', data);
            })
            .catch(error => {
                console.error('Ошибка:', error);
            });
        });
    </script>

</body>
</html>
